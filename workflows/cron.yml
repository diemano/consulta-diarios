name: Rodar monitor diário (09h e 17h BRT)

on:
  schedule:
    - cron: "0 12 * * *"   # 09:00 BRT (UTC-3) -> 12:00 UTC
    - cron: "0 20 * * *"   # 17:00 BRT (UTC-3) -> 20:00 UTC
  workflow_dispatch:       # permite rodar manualmente

jobs:
  hit-function:
    runs-on: ubuntu-latest
    env:
      SITE_URL: ${{ secrets.SITE_URL }}
    steps:
      - name: Verificar variável SITE_URL
        run: |
          if [ -z "$SITE_URL" ]; then
            echo "Defina o secret SITE_URL com a URL do seu site Netlify (ex.: https://consultadiarios.netlify.app)"; exit 1;
          fi

      - name: Disparar função check-doepb (todas as fontes)
        run: |
          set -euo pipefail
          curl -fsS --retry 3 --max-time 120 \
            "$SITE_URL/.netlify/functions/check-doepb?snippets=1"
